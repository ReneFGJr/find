<div class="container mt-4">
  <h2>Lista de Usuários</h2>

  <!-- Indicador de carregamento -->
  <div *ngIf="isLoading" class="alert alert-info">Carregando usuários…</div>

  <!-- Mensagem de erro -->
  <div *ngIf="errorMsg" class="alert alert-danger">{{ errorMsg }}</div>

  <!-- Campo de busca + botão novo usuário -->
  <div class="mb-3" *ngIf="!isLoading && !errorMsg">
    <div class="input-group">
      <input
        #searchInput
        (keyup)="filterUsers(searchInput.value)"
        type="text"
        class="form-control"
        placeholder="Buscar por nome ou login..."
      />
      <button
        class="btn btn-success"
        type="button"
        (click)="createUser()"
        title="Adicionar novo usuário"
      >
        <i class="bi bi-person-plus-fill me-1"></i> Novo Usuário
      </button>
    </div>
  </div>

  <!-- Tabela -->
  <table *ngIf="!isLoading && !errorMsg" class="table table-striped table-hover">
    <thead class="thead-light">
      <tr>
        <th>Nome</th>
        <th>Login</th>
        <th>Último Acesso</th>
        <th>Gênero</th>
        <th>Cadastro</th>
        <th>Membro</th>
        <th style="width: 180px;">Ações</th>
      </tr>
    </thead>

    <tbody *ngIf="paginatedUsers.length > 0; else noDataTpl">
      <tr *ngFor="let user of paginatedUsers">
        <td>{{ user.us_nome }}</td>
        <td>{{ user.us_login }}</td>
        <td>{{ formatDateString(user.us_last) }}</td>
        <td>{{ user.us_genero || '—' }}</td>
        <td>{{ formatDateString(user.us_cadastro) }}</td>
        <td>
          <span class="btn p-0 m-0 btn-primary full" *ngIf="isMember(user.ul_library)">
            Membro
          </span>
        </td>
        <td>
          <button
            class="btn btn-sm btn-info me-1"
            (click)="viewDetails(user)"
            title="Visualizar detalhes"
          >
            <i class="bi bi-eye"></i>
          </button>
          <button
            class="btn btn-sm btn-warning me-1"
            (click)="editUser(user)"
            title="Editar usuário"
          >
            <i class="bi bi-pencil"></i>
          </button>

          <button
            *ngIf="!isMember(user.ul_library)"
            class="btn btn-sm btn-success me-1"
            (click)="activateUser(user)"
            title="Tornar membro da biblioteca"
          >
            <i class="bi bi-plus"></i>
          </button>

          <button
            *ngIf="isMember(user.ul_library)"
            class="btn btn-sm btn-danger"
            (click)="inactivateUser(user)"
            title="Remover membro da biblioteca"
          >
            <i class="bi bi-door-open"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Sem dados -->
  <ng-template #noDataTpl>
    <div class="alert alert-warning">Nenhum usuário cadastrado no sistema.</div>
  </ng-template>

  <!-- Paginação -->
  <nav *ngIf="totalPages > 1" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="previousPage()">Anterior</a>
      </li>

      <li class="page-item disabled">
        <span class="page-link">
          Página {{ currentPage }} de {{ totalPages }}
        </span>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="nextPage()">Próxima</a>
      </li>
    </ul>
  </nav>
</div>
